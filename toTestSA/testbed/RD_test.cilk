#include <cilk-lib.cilkh>
#include <stdlib.h>
#include <stdio.h>


cilk void sp_write(int * x, int _z){
	WRITE(x, &_z);
}

cilk int main(int argv, char* argc){
	int * x, y;
	int * b;
	int * c;
	int * d;
	int * e;

	x = RD_INIT(int, 1);
	b = RD_INIT(int, 1);
	c = RD_INIT(int, 1);
	d = RD_INIT(int, 1);
	e = RD_INIT(int, 1);

	spawn sp_write(x, 1);
	spawn sp_write(x, 1);
	spawn sp_write(x, 1);
	spawn sp_write(x, 2);

	y = READ(x, int);

	spawn sp_write(x, 2);

	y = READ(x, int);

	spawn sp_write(x, 2);

	y = READ(x, int);

	printf("before sync\n:");
	sync;

	printf("y: %d\n", y);
	RD_free(_cilk_ws, (void *)x);
	RD_free(_cilk_ws, (void *)b);
	RD_free(_cilk_ws, (void *)c);
	RD_free(_cilk_ws, (void *)d);
	RD_free(_cilk_ws, (void *)e);


	return 0;
}
