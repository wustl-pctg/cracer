#include <cilk-lib.cilkh>
#include <stdlib.h>
#include <stdio.h>

#define RD_INIT(type) (type * )RD_structure_create(_cilk_ws, sizeof(type))
#define READ(mem, type) *(type *)Race_detect_read(_cilk_ws, mem)
#define WRITE(mem, mem_to_copy) Race_detect_write(_cilk_ws, mem, mem_to_copy)

cilk void sp_write(int * x, int _z){
	WRITE(x, &_z);
	
}

cilk int main(int argv, char* argc){
	int * x, *y;
	
	x = RD_INIT(int);
	
	spawn sp_write(x, 1);
	spawn sp_write(x, 2);

	*y = READ(x, int); 	
	

	sync;
	printf("y: %d\n", *y);
	
	RD_free(_cilk_ws, (void *)x);

	return 0;
}
