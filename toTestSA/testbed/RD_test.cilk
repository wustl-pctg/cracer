#include <cilk-lib.cilkh>
#include <stdlib.h>
#include <stdio.h>


cilk void sp_write(int * x, int _z){
	WRITE(x, &_z);
}

cilk int main(int argv, char* argc){
	int * x, y;

	x = RD_INIT(int);

	spawn sp_write(x, 1);
	spawn sp_write(x, 1);
	spawn sp_write(x, 1);
	spawn sp_write(x, 2);

	y = READ(x, int);

	spawn sp_write(x, 2);

	y = READ(x, int);

	spawn sp_write(x, 2);

	y = READ(x, int);

	printf("before sync\n:");
	sync;

	printf("y: %d\n", y);
	RD_free(_cilk_ws, (void *)x);

	return 0;
}
